{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///project/sandbox/user-workspace/src/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'fallback_secret_key';\n\nexport interface TokenPayload {\n  userId: number;\n  username: string;\n  role: 'admin' | 'user';\n  iat?: number;\n  exp?: number;\n}\n\nexport function generateToken(payload: Omit<TokenPayload, 'iat' | 'exp'>): string {\n  try {\n    return jwt.sign(payload, JWT_SECRET, { expiresIn: '24h' });\n  } catch (error) {\n    console.error('Error generating token:', error);\n    throw new Error('Failed to generate authentication token');\n  }\n}\n\nexport function verifyToken(token: string): TokenPayload | null {\n  try {\n    const decoded = jwt.verify(token, JWT_SECRET) as TokenPayload;\n    return decoded;\n  } catch (error) {\n    console.error('Error verifying token:', error);\n    return null;\n  }\n}\n\nexport function decodeToken(token: string): TokenPayload | null {\n  try {\n    const decoded = jwt.decode(token) as TokenPayload;\n    return decoded;\n  } catch (error) {\n    console.error('Error decoding token:', error);\n    return null;\n  }\n}\n\n// Client-side token management\nexport const tokenManager = {\n  setToken: (token: string) => {\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('auth_token', token);\n    }\n  },\n\n  getToken: (): string | null => {\n    if (typeof window !== 'undefined') {\n      return localStorage.getItem('auth_token');\n    }\n    return null;\n  },\n\n  removeToken: () => {\n    if (typeof window !== 'undefined') {\n      localStorage.removeItem('auth_token');\n    }\n  },\n\n  isTokenValid: (token: string): boolean => {\n    try {\n      const decoded = decodeToken(token);\n      if (!decoded || !decoded.exp) return false;\n      \n      const currentTime = Math.floor(Date.now() / 1000);\n      return decoded.exp > currentTime;\n    } catch {\n      return false;\n    }\n  }\n};\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAUtC,SAAS,cAAc,OAA0C;IACtE,IAAI;QACF,OAAO,qIAAA,CAAA,UAAG,CAAC,IAAI,CAAC,SAAS,YAAY;YAAE,WAAW;QAAM;IAC1D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,MAAM,IAAI,MAAM;IAClB;AACF;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,MAAM,UAAU,qIAAA,CAAA,UAAG,CAAC,MAAM,CAAC,OAAO;QAClC,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO;IACT;AACF;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,MAAM,UAAU,qIAAA,CAAA,UAAG,CAAC,MAAM,CAAC;QAC3B,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO;IACT;AACF;AAGO,MAAM,eAAe;IAC1B,UAAU,CAAC;QACT,uCAAmC;;QAEnC;IACF;IAEA,UAAU;QACR,uCAAmC;;QAEnC;QACA,OAAO;IACT;IAEA,aAAa;QACX,uCAAmC;;QAEnC;IACF;IAEA,cAAc,CAAC;QACb,IAAI;YACF,MAAM,UAAU,YAAY;YAC5B,IAAI,CAAC,WAAW,CAAC,QAAQ,GAAG,EAAE,OAAO;YAErC,MAAM,cAAc,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;YAC5C,OAAO,QAAQ,GAAG,GAAG;QACvB,EAAE,OAAM;YACN,OAAO;QACT;IACF;AACF","debugId":null}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///project/sandbox/user-workspace/src/hooks/useAuth.ts"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { tokenManager, decodeToken, TokenPayload } from '@/lib/auth';\n\ninterface User {\n  id: number;\n  username: string;\n  role: 'admin' | 'user';\n  active: boolean;\n  questionsAnswered: number;\n  correctAnswers: number;\n  createdAt: string;\n}\n\ninterface AuthState {\n  user: User | null;\n  token: string | null;\n  isLoading: boolean;\n  isAuthenticated: boolean;\n}\n\nexport function useAuth() {\n  const [authState, setAuthState] = useState<AuthState>({\n    user: null,\n    token: null,\n    isLoading: true,\n    isAuthenticated: false,\n  });\n\n  // Initialize auth state from localStorage\n  useEffect(() => {\n    const initializeAuth = () => {\n      const token = tokenManager.getToken();\n      \n      if (token && tokenManager.isTokenValid(token)) {\n        const payload = decodeToken(token);\n        if (payload) {\n          setAuthState({\n            user: {\n              id: payload.userId,\n              username: payload.username,\n              role: payload.role,\n              active: true,\n              questionsAnswered: 0,\n              correctAnswers: 0,\n              createdAt: '',\n            },\n            token,\n            isLoading: false,\n            isAuthenticated: true,\n          });\n          return;\n        }\n      }\n      \n      // Token is invalid or doesn't exist\n      tokenManager.removeToken();\n      setAuthState({\n        user: null,\n        token: null,\n        isLoading: false,\n        isAuthenticated: false,\n      });\n    };\n\n    initializeAuth();\n  }, []);\n\n  const login = useCallback(async (username: string, password: string) => {\n    try {\n      const response = await fetch('/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ username, password }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Erro no login');\n      }\n\n      // Store token and update state\n      tokenManager.setToken(data.token);\n      setAuthState({\n        user: data.user,\n        token: data.token,\n        isLoading: false,\n        isAuthenticated: true,\n      });\n\n      return { success: true, user: data.user };\n    } catch (error) {\n      console.error('Login error:', error);\n      return { \n        success: false, \n        error: error instanceof Error ? error.message : 'Erro no login' \n      };\n    }\n  }, []);\n\n  const logout = useCallback(async () => {\n    try {\n      const token = tokenManager.getToken();\n      if (token) {\n        // Call logout API to set user as inactive\n        await fetch('/api/auth/login', {\n          method: 'DELETE',\n          headers: {\n            'Authorization': `Bearer ${token}`,\n          },\n        });\n      }\n    } catch (error) {\n      console.error('Logout API error:', error);\n    } finally {\n      // Always clear local state regardless of API call result\n      tokenManager.removeToken();\n      setAuthState({\n        user: null,\n        token: null,\n        isLoading: false,\n        isAuthenticated: false,\n      });\n    }\n  }, []);\n\n  const updateUserStats = useCallback(async (questionsAnswered: number, correctAnswers: number) => {\n    if (!authState.user || !authState.token) return false;\n\n    try {\n      const response = await fetch('/api/users', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${authState.token}`,\n        },\n        body: JSON.stringify({\n          userId: authState.user.id,\n          questionsAnswered,\n          correctAnswers,\n        }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Erro ao atualizar estatÃ­sticas');\n      }\n\n      // Update local user state\n      setAuthState(prev => ({\n        ...prev,\n        user: prev.user ? {\n          ...prev.user,\n          questionsAnswered: data.user.questionsAnswered,\n          correctAnswers: data.user.correctAnswers,\n        } : null,\n      }));\n\n      return true;\n    } catch (error) {\n      console.error('Update stats error:', error);\n      return false;\n    }\n  }, [authState.user, authState.token]);\n\n  const refreshUserData = useCallback(async () => {\n    if (!authState.token || !authState.user) return;\n\n    try {\n      // For now, we'll just keep the current user data\n      // In a real app, you might want to fetch fresh user data from an API\n      const payload = decodeToken(authState.token);\n      if (payload && tokenManager.isTokenValid(authState.token)) {\n        // Token is still valid, keep current state\n        return;\n      } else {\n        // Token expired, logout\n        await logout();\n      }\n    } catch (error) {\n      console.error('Refresh user data error:', error);\n      await logout();\n    }\n  }, [authState.token, authState.user, logout]);\n\n  return {\n    ...authState,\n    login,\n    logout,\n    updateUserStats,\n    refreshUserData,\n  };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 294, "column": 0}, "map": {"version":3,"sources":["file:///project/sandbox/user-workspace/src/app/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '@/hooks/useAuth';\n\nexport default function HomePage() {\n  const router = useRouter();\n  const { isAuthenticated, isLoading } = useAuth();\n\n  useEffect(() => {\n    if (!isLoading) {\n      if (isAuthenticated) {\n        router.push('/dashboard');\n      } else {\n        router.push('/login');\n      }\n    }\n  }, [isAuthenticated, isLoading, router]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Carregando...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return null;\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS;IACtB,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,EAAE,eAAe,EAAE,SAAS,EAAE,GAAG,CAAA,GAAA,uHAAA,CAAA,UAAO,AAAD;IAE7C,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,IAAI,CAAC,WAAW;YACd,IAAI,iBAAiB;gBACnB,OAAO,IAAI,CAAC;YACd,OAAO;gBACL,OAAO,IAAI,CAAC;YACd;QACF;IACF,GAAG;QAAC;QAAiB;QAAW;KAAO;IAEvC,IAAI,WAAW;QACb,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;;;;;kCACf,8OAAC;wBAAE,WAAU;kCAAqB;;;;;;;;;;;;;;;;;IAI1C;IAEA,OAAO;AACT","debugId":null}}]
}